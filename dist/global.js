!function(){function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function n(e,n){if(null==e)return{};var r,i,s=t(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}iina.menu;var r=iina.file,i=iina.console,s="@data/script-list.json";function o(){var e=function(){r.write(s,"[]")};r.exists(s)||e();var t=r.read(s),n=[];try{n=JSON.parse(t),i.log(`Scripts loaded: ${n.length}`)}catch(n){i.log("Cannot parse the script list - will recreate one"),r.write("@data/script-list.json.backup",t),e()}return n}var a=iina.menu,c=iina.file,l=iina.console,p=iina.standaloneWindow;function f(e){if(!Array.isArray(e))throw new Error("saveUserScripts: scripts should be an array");c.write(s,JSON.stringify(e))}p.loadFile("dist/standalone/index.html"),p.onMessage("load-scripts",(function(){p.postMessage("load-scripts-done",o())})),p.onMessage("save-scripts",(function(e){p.postMessage("save-scripts-done",f(e))})),p.onMessage("get-script-content",(function(e){var t=`@data/${e.id}.js`;c.exists(t)||(l.log(`File ${t} doesn't exist; creating.`),c.write(t,"")),content=encodeURI(c.read(t)),p.postMessage("get-script-content-done",{content:content})})),p.onMessage("get-script-info",(function(e){var t=e.id,n=o().find((function(e){return e.id===t}));p.postMessage("get-script-info-done",n)})),p.onMessage("set-script-info",(function(t){var r=t.id,i=n(t,["id"]);f(o().map((function(t){return t.id===r?function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),i.forEach((function(n){e(t,n,r[n])}))}return t}({},t,i):t}))),p.postMessage("set-script-info-done",{})})),p.onMessage("set-script-content",(function(e){var t=e.id,n=e.content,r=`@data/${t}.js`;c.exists(r)||(l.log(`File ${r} doesn't exist; creating.`),c.write(r,"")),c.write(r,decodeURI(n)),p.postMessage("set-script-content-done",{})})),p.setProperty({title:"User Scripts"}),a.addItem(a.item("Manage User Scripts...",(function(){p.open()})))}();
//# sourceMappingURL=global.js.map
